#include <lcd.h>
#include <iis.h>

#include "config.h"
#include "pixmaps.h"
#include "wavs.h"
#include "game.h"

static const uint8 shieldCol[MAX_SHIELDS] = { 23, 69, 115 };

void game_init( Game *self )
{
    uint8 i;
    
    self->state = run;
    for( i=0; i<MAX_SHIELDS; i++ )
        shield_init( &self->shield[i], shieldCol[i] );
    player_init( &self->player );
    playerShot_init( &self->playerShot );
    ufo_init( &self->ufo );
    swarm_init( &self->swarm );
    enemyShot_init( &self->enemyShot );
    hiScore_init( &self->hiScore );
    credit_init( &self->credit );
    self->music = (Sound){ INTRO_MUSIC };
    sound_loop( &self->music );
}

void game_restart( Game *self )
{
    // Limpia la pantalla y reinicializa los objetos del juego
    lcd_clear();

    // Asumimos que los créditos se mantienen, pero el estado del juego se reinicia
    // Excepto HiScore y Credit que persisten fuera del ciclo de una partida única

    uint8 i;
    for( i=0; i<MAX_SHIELDS; i++ )
    {
        shield_init( &self->shield[i], shieldCol[i] );
        shield_launch( &self->shield[i] );
    }

    player_init( &self->player );
    playerShot_init( &self->playerShot );
    ufo_init( &self->ufo );
    swarm_init( &self->swarm );
    enemyShot_init( &self->enemyShot );
    
    // Música reinicia
    sound_loop( &self->music );
    
    self->state = run;
}

void game_launch( Game *self )
{
   credit_launch( &self->credit );
   // Dibujar elementos iniciales
   uint8 i;
   for( i=0; i<MAX_SHIELDS; i++ )
       shield_launch( &self->shield[i] );

   player_launch( &self->player );
   hiScore_launch( &self->hiScore );
   score_launch( &self->player.score );
   lives_launch( &self->player.lives );
}
