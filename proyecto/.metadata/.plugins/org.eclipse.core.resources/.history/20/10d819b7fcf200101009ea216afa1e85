#include <lcd.h>
#include <iis.h>

#include "config.h"
#include "pixmaps.h"
#include "wavs.h"
#include "game.h"

static const uint8 shieldCol[MAX_SHIELDS] = { 23, 69, 115 };

void game_init( Game *self )
{
    uint8 i;
    
    self->state = run;
    for( i=0; i<MAX_SHIELDS; i++ )
        shield_init( &self->shield[i], shieldCol[i] );
    player_init( &self->player );
    playerShot_init( &self->playerShot );
    ufo_init( &self->ufo );
    swarm_init( &self->swarm );
    enemyShot_init( &self->enemyShot );
    hiScore_init( &self->hiScore );
    credit_init( &self->credit );
    self->music = (Sound){ INTRO_MUSIC };
    sound_loop( &self->music );
}

void game_restart( Game *self )
{
    uint8 i;

    // reiniciar el juego
    self->state = run;

    // reiniciar componentes
    for( i=0; i<MAX_SHIELDS; i++ )
        shield_init( &self->shield[i], shieldCol[i] );
        
    player_init( &self->player );
    playerShot_init( &self->playerShot );
    ufo_init( &self->ufo );
    swarm_init( &self->swarm );
    enemyShot_init( &self->enemyShot );
    
    score_init( &self->player.score );
    
    lcd_clear();
    game_launch(self);
}

void game_launch( Game *self )
{
   credit_launch( &self->credit );
}
